<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Speedball 3D</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="assets/images/icon.png">
    <link rel="stylesheet" href="style.css">
    
    <!-- OAuth Styles -->
    <style>
        .oauth-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }
        
        .oauth-btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
            color: white;
        }
        
        .oauth-btn:hover {
            transform: translateY(-3px);
        }
        
        .github-btn {
            background: linear-gradient(135deg, #24292e 0%, #181c20 100%);
        }
        
        .google-btn {
            background: linear-gradient(135deg, #4285F4 0%, #3367D6 100%);
        }
        
        .discord-btn {
            background: linear-gradient(135deg, #5865F2 0%, #4752C4 100%);
        }
        
        .oauth-divider {
            text-align: center;
            margin: 20px 0;
            color: rgba(255, 255, 255, 0.5);
            position: relative;
        }
        
        .oauth-divider::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            width: 45%;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .oauth-divider::after {
            content: "";
            position: absolute;
            right: 0;
            top: 50%;
            width: 45%;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Loading Screen -->
        <div id="loading-screen" class="screen active">
            <div class="loader">
                <div class="spinner"></div>
                <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
        </div>

        <!-- Menu Screen -->
        <div id="menu-screen" class="screen">
            <div class="menu-header">
                <h1 class="game-title">SPEEDBALL 3D</h1>
                <div class="user-info" id="user-info"></div>
            </div>
            <div class="menu-buttons">
                <button class="menu-btn play-btn" id="btn-play">â–¶ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
                <button class="menu-btn" id="btn-profile">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
                <button class="menu-btn" id="btn-leaderboard">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</button>
                <button class="menu-btn" id="btn-settings">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>
            <div class="stats-preview">
                <div class="stat-item">
                    <span class="stat-label">Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©</span>
                    <span class="stat-value" id="best-score">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ø§Ù„Ø¹Ù…Ù„Ø§Øª</span>
                    <span class="stat-value" id="coins">0</span>
                </div>
            </div>
        </div>

        <!-- Auth Screen -->
        <div id="auth-screen" class="screen">
            <div class="auth-container">
                <button class="back-btn" id="auth-back">â† Ø±Ø¬ÙˆØ¹</button>
                <h2 id="auth-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                
                <!-- Ø£Ø²Ø±Ø§Ø± OAuth -->
                <div class="oauth-buttons">
                    <button class="oauth-btn github-btn" onclick="loginWithGitHub()">
                        <span>ğŸ™</span> GitHub
                    </button>
                    
                    <button class="oauth-btn google-btn" onclick="loginWithGoogle()">
                        <span>ğŸ”</span> Google
                    </button>
                    
                    <button class="oauth-btn discord-btn" onclick="loginWithDiscord()">
                        <span>ğŸ’¬</span> Discord
                    </button>
                </div>
                
                <div class="oauth-divider">Ø£Ùˆ</div>
                
                <form id="auth-form">
                    <div class="input-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Gmail)</label>
                        <input type="email" id="auth-email" placeholder="example@gmail.com" required>
                        <span class="input-hint" id="email-hint"></span>
                    </div>
                    <div class="input-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
                        <input type="password" id="auth-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                        <div class="password-strength"><div class="password-strength-bar" id="password-strength"></div></div>
                        <span class="input-hint" id="password-hint"></span>
                    </div>
                    <button type="submit" class="submit-btn"><span id="auth-submit-text">Ø¯Ø®ÙˆÙ„</span></button>
                </form>
                <p class="auth-toggle">
                    <span id="auth-toggle-text">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</span>
                    <a href="#" id="auth-toggle-link">Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</a>
                </p>
                <div class="auth-message" id="auth-message"></div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-ui">
                <div class="game-header">
                    <div class="score-display">
                        <span class="label">Ø§Ù„Ù†Ù‚Ø§Ø·</span>
                        <span class="value" id="game-score">0</span>
                    </div>
                    <div class="time-display">
                        <span class="label">â±ï¸</span>
                        <span class="value" id="game-time">0</span>
                    </div>
                    <button class="pause-btn" id="btn-pause">â¸ï¸</button>
                </div>
                <canvas id="game-canvas"></canvas>
                <div class="game-controls">
                    <button class="control-btn" id="btn-left">â—€ï¸</button>
                    <button class="control-btn" id="btn-jump">â¬†ï¸</button>
                    <button class="control-btn" id="btn-right">â–¶ï¸</button>
                </div>
            </div>
        </div>

        <!-- Profile Screen -->
        <div id="profile-screen" class="screen">
            <button class="back-btn" id="profile-back">â† Ø±Ø¬ÙˆØ¹</button>
            <div class="profile-container"></div>
        </div>

        <!-- Leaderboard Screen -->
        <div id="leaderboard-screen" class="screen">
            <button class="back-btn" id="leaderboard-back">â† Ø±Ø¬ÙˆØ¹</button>
            <div class="leaderboard-container">
                <h2>ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
                <div class="leaderboard-list" id="leaderboard-list"></div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings-screen" class="screen">
            <button class="back-btn" id="settings-back">â† Ø±Ø¬ÙˆØ¹</button>
            <div class="settings-container"></div>
        </div>
    </div>

    <!-- âš¡ Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- ğŸ“¦ OAuth Manager -->
    <script>
    // ============================================
    // ğŸ”— OAUTH MANAGER (GitHub + Discord + Google)
    // ============================================
    
    // ğŸ”µ GitHub OAuth
    async function loginWithGitHub() {
        try {
            if (!window.supabaseClient) {
                throw new Error('Supabase client not loaded');
            }
            
            const { data, error } = await supabaseClient.auth.signInWithOAuth({
                provider: 'github',
                options: {
                    redirectTo: window.location.origin + '/',
                    queryParams: { prompt: 'login' }
                }
            });
            
            if (error) throw error;
            
        } catch (err) {
            console.error('GitHub login error:', err);
            showAuthMessage('GitHub login failed: ' + err.message, 'error');
        }
    }
    
    // ğŸ”µ Google OAuth
    async function loginWithGoogle() {
        try {
            if (!window.supabaseClient) {
                throw new Error('Supabase client not loaded');
            }
            
            const { data, error } = await supabaseClient.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    redirectTo: window.location.origin + '/',
                    queryParams: {
                        access_type: 'offline',
                        prompt: 'consent'
                    }
                }
            });
            
            if (error) throw error;
            
        } catch (err) {
            console.error('Google login error:', err);
            showAuthMessage('Google login failed: ' + err.message, 'error');
        }
    }
    
    // ğŸ”µ Discord OAuth
    async function loginWithDiscord() {
        try {
            if (!window.supabaseClient) {
                throw new Error('Supabase client not loaded');
            }
            
            const { data, error } = await supabaseClient.auth.signInWithOAuth({
                provider: 'discord',
                options: {
                    redirectTo: window.location.origin + '/'
                }
            });
            
            if (error) throw error;
            
        } catch (err) {
            console.error('Discord login error:', err);
            showAuthMessage('Discord login failed: ' + err.message, 'error');
        }
    }
    
    function showAuthMessage(message, type = 'info') {
        const messageEl = document.getElementById('auth-message');
        if (messageEl) {
            messageEl.textContent = message;
            messageEl.className = `auth-message ${type}`;
            messageEl.style.display = 'block';
            setTimeout(() => messageEl.style.display = 'none', 5000);
        } else {
            alert(message);
        }
    }
    
    // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    console.log('âœ… OAuth Manager Loaded');
    </script>
    
    <!-- ğŸ“¦ Main App (Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¯ÙˆÙ† modules) -->
    <script>
        console.log('ğŸ® Starting Speedball 3D...');
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Supabase
        if (typeof supabase === 'undefined') {
            console.error('âŒ Supabase not loaded!');
            document.querySelector('#loading-screen p').textContent = 'Ø®Ø·Ø£: ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©';
        } else {
            console.log('âœ… Supabase loaded successfully');
        }
        
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
        setTimeout(() => {
            const loadingScreen = document.getElementById('loading-screen');
            const menuScreen = document.getElementById('menu-screen');
            const authScreen = document.getElementById('auth-screen');
            
            if (loadingScreen) loadingScreen.classList.remove('active');
            
            // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©
            if (authScreen) authScreen.classList.add('active');
            
            console.log('âœ… App loaded');
        }, 2000);
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        document.addEventListener('DOMContentLoaded', () => {
            // Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            const authBack = document.getElementById('auth-back');
            if (authBack) {
                authBack.addEventListener('click', () => {
                    document.getElementById('auth-screen').classList.remove('active');
                    document.getElementById('menu-screen').classList.add('active');
                });
            }
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ØªØ³Ø¬ÙŠÙ„ ÙˆØ¯Ø®ÙˆÙ„
            const toggleLink = document.getElementById('auth-toggle-link');
            if (toggleLink) {
                toggleLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    const title = document.getElementById('auth-title');
                    const submitText = document.getElementById('auth-submit-text');
                    const toggleText = document.getElementById('auth-toggle-text');
                    
                    if (title.textContent === 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„') {
                        title.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
                        submitText.textContent = 'ØªØ³Ø¬ÙŠÙ„';
                        toggleText.textContent = 'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ';
                        toggleLink.textContent = 'Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„';
                    } else {
                        title.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                        submitText.textContent = 'Ø¯Ø®ÙˆÙ„';
                        toggleText.textContent = 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ';
                        toggleLink.textContent = 'Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†';
                    }
                });
            }
            
            console.log('âœ… Basic UI initialized');
        });
    </script>
</body>
</html>
