<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, height=device-height">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Ù…Ø­Ø±Ø± Ø§Ù„Ù†ØµÙˆØµ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±</title>
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    
    <style>
        /* Ù…Ù†Ø¹ resize Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ */
        html {
            height: 100vh;
            height: -webkit-fill-available;
        }
        
        body {
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }
        
        /* ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .keyboard-fixed {
            position: fixed !important;
            transform: none !important;
        }
        
        /* Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø·ÙˆÙŠÙ„ */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .text-overlay {
            -webkit-user-select: text !important;
            user-select: text !important;
        }
    </style>
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ØµÙØ­Ø© Ø§Ù„ÙØ¦Ø§Øª -->
    <div id="categoriesPage" class="page active">
        <div class="header">
            <h1>Ø§Ø®ØªØ± ÙØ¦Ø©</h1>
        </div>
        <div class="categories-grid" id="categoriesGrid"></div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„ØµÙˆØ± -->
    <div id="imagesPage" class="page">
        <div class="header">
            <button onclick="showPage('categories')" class="icon-btn back-btn">
                <span class="material-symbols-outlined">arrow_back</span>
            </button>
            <h1 id="categoryTitle">Ø§Ù„ØµÙˆØ±</h1>
        </div>
        <div class="image-grid" id="imageGrid"></div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø±Ø± -->
    <div id="editorPage" class="page">
        <div class="header">
            <button onclick="goBackToImages()" class="icon-btn back-btn">
                <span class="material-symbols-outlined">arrow_back</span>
            </button>
            <h1 data-lang="edit">ØªØ­Ø±ÙŠØ±</h1>
            <div class="header-actions">
                <button onclick="shareImage()" class="icon-btn" title="Ù…Ø´Ø§Ø±ÙƒØ©" id="shareBtn">
                    <span class="material-symbols-outlined">share</span>
                </button>
                <button onclick="downloadImage()" class="icon-btn" title="ØªÙ†Ø²ÙŠÙ„" id="downloadBtn">
                    <span class="material-symbols-outlined">download</span>
                </button>
            </div>
        </div>
        
        <div class="editor-container">
            <div class="canvas-wrapper-fixed" id="canvasWrapperFixed">
                <canvas id="canvas"></canvas>
                <div class="text-overlay" id="textOverlay" contenteditable="true" spellcheck="false"></div>
            </div>

            <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­Ø±ÙŠØ± -->
            <div class="editor-toolbar">
                <button class="tool-btn" onclick="toggleToolPanel('fontPanel')">
                    <span class="material-symbols-outlined">brand_family</span>
                    <span data-lang="font">Ø§Ù„Ø®Ø·</span>
                </button>

                <button class="tool-btn" onclick="toggleToolPanel('sizePanel')">
                    <span class="material-symbols-outlined">format_size</span>
                    <span data-lang="size">Ø§Ù„Ø­Ø¬Ù…</span>
                </button>

                <button class="tool-btn" onclick="toggleToolPanel('colorPanel')">
                    <span class="material-symbols-outlined">colors</span>
                    <span data-lang="color">Ø§Ù„Ù„ÙˆÙ†</span>
                </button>

                <button class="tool-btn" onclick="toggleToolPanel('strokePanel')">
                    <span class="material-symbols-outlined">format_color_text</span>
                    <span data-lang="stroke">Ø§Ù„Ø­ÙˆØ§Ù</span>
                </button>

                <button class="tool-btn" onclick="toggleToolPanel('effectsPanel')">
                    <span class="material-symbols-outlined">bedtime</span>
                    <span data-lang="effects">ØªØ£Ø«ÙŠØ±Ø§Øª</span>
                </button>
            </div>

            <!-- Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
            <div id="fontPanel" class="tool-panel">
                <select id="fontFamily" class="tool-select"></select>
            </div>

            <div id="sizePanel" class="tool-panel">
                <input type="range" id="fontSize" min="20" max="120" value="48" class="size-slider">
                <span id="fontSizeDisplay">48</span>
            </div>

            <div id="colorPanel" class="tool-panel">
                <div class="color-grid" id="colorGrid"></div>
            </div>

            <div id="strokePanel" class="tool-panel">
                <div class="color-grid" id="strokeColorGrid"></div>
                <input type="range" id="strokeWidth" min="0" max="10" value="3" class="stroke-slider">
                <span id="strokeWidthDisplay">3</span>
            </div>

            <div id="effectsPanel" class="tool-panel">
                <label class="effect-option">
                    <input type="checkbox" id="shadowEnabled" checked>
                    <span data-lang="shadow">Ø¸Ù„</span>
                </label>
                <label class="effect-option">
                    <input type="checkbox" id="cardEnabled">
                    <span data-lang="background">Ø®Ù„ÙÙŠØ©</span>
                </label>
                <div class="color-grid" id="cardColorGrid"></div>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div id="settingsPage" class="page">
        <div class="header">
            <h1 data-lang="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
        </div>
        <div class="settings-content">
            <div class="setting-card">
                <h3 data-lang="theme">Ø§Ù„Ø³Ù…Ø©</h3>
                <div class="theme-options">
                    <button class="theme-btn active" onclick="changeTheme('light')" data-theme="light">
                        <span data-lang="light">ÙØ§ØªØ­</span>
                    </button>
                    <button class="theme-btn" onclick="changeTheme('dark')" data-theme="dark">
                        <span data-lang="dark">Ø¯Ø§ÙƒÙ†</span>
                    </button>
                    <button class="theme-btn" onclick="changeTheme('blue')" data-theme="blue">
                        <span data-lang="blue">Ø£Ø²Ø±Ù‚</span>
                    </button>
                </div>
            </div>

            <div class="setting-card">
                <h3 data-lang="language">Ø§Ù„Ù„ØºØ©</h3>
                <div class="language-options">
                    <button class="lang-btn active" onclick="changeLanguage('ar')" data-lang-btn="ar">
                        Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                    </button>
                    <button class="lang-btn" onclick="changeLanguage('en')" data-lang-btn="en">
                        English
                    </button>
                    <button class="lang-btn" onclick="changeLanguage('fr')" data-lang-btn="fr">
                        FranÃ§ais
                    </button>
                </div>
            </div>

            <div class="setting-card">
                <a href="https://imgur.com/rMuCo3W" target="_blank" class="setting-link">
                    <span class="material-symbols-outlined">shield</span>
                    <span data-lang="privacy">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</span>
                </a>
                <a href="https://imgur.com/rMuCo3W" target="_blank" class="setting-link">
                    <span class="material-symbols-outlined">info</span>
                    <span data-lang="about">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙˆÙ„</span>
                </a>
                <a href="https://imgur.com/rMuCo3W" target="_blank" class="setting-link">
                    <span class="material-symbols-outlined">help</span>
                    <span data-lang="help">Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</span>
                </a>
                <a href="https://imgur.com/rMuCo3W" target="_blank" class="setting-link">
                    <span class="material-symbols-outlined">mail</span>
                    <span data-lang="contact">Ø§ØªØµÙ„ Ø¨Ù†Ø§</span>
                </a>
            </div>

            <div class="setting-card">
                <p style="text-align: center; color: #86868b; font-size: 14px;">
                    <span data-lang="version">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</span> 2.1
                </p>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© -->
    <div class="bottom-nav">
        <button onclick="showPage('categories')" class="nav-btn active" id="navCategories">
            <span class="material-symbols-outlined">dashboard</span>
            <span data-lang="categories">Ø§Ù„ÙØ¦Ø§Øª</span>
        </button>
        <button onclick="showPage('editor')" class="nav-btn" id="navEditor">
            <span class="material-symbols-outlined">edit</span>
            <span data-lang="editor">Ø§Ù„ØªØ­Ø±ÙŠØ±</span>
        </button>
        <button onclick="showPage('settings')" class="nav-btn" id="navSettings">
            <span class="material-symbols-outlined">settings</span>
            <span data-lang="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
        </button>
    </div>

    <!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ -->
    <script src="js/fonts.js"></script>
    <script src="js/colors.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // ============== Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ© ==============
        
        // Ù…Ù†Ø¹ resize Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        window.addEventListener('resize', function() {
            document.body.style.height = window.innerHeight + 'px';
        });
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø£ÙˆÙ„ÙŠ
        document.body.style.height = window.innerHeight + 'px';
        
        // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù†Ø¯ ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        window.addEventListener('scroll', function() {
            if (document.body.classList.contains('keyboard-open')) {
                window.scrollTo(0, 0);
            }
        });
        
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
        window.addEventListener('load', function() {
            console.log('Page fully loaded');
            if (typeof initializeColors === 'function') {
                setTimeout(initializeColors, 100);
            }
        });
        
        // ============== Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªÙ†Ø²ÙŠÙ„ ==============
        
        // Ù…Ù†Ø¹ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ø²ÙŠÙ„ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        document.addEventListener('DOMContentLoaded', function() {
            // Ø¥ØµÙ„Ø§Ø­ Ø²Ø± Ø§Ù„ØªÙ†Ø²ÙŠÙ„
            const downloadBtn = document.getElementById('downloadBtn');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    return false;
                }, true);
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø¢Ø®Ø± Ù„Ù„ØªØ£ÙƒØ¯
                downloadBtn.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                    return false;
                }, true);
                
                downloadBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    return false;
                }, true);
            }
            
            // Ø¥ØµÙ„Ø§Ø­ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
            const shareBtn = document.getElementById('shareBtn');
            if (shareBtn) {
                shareBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    return false;
                }, true);
                
                shareBtn.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                    return false;
                }, true);
                
                shareBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    return false;
                }, true);
            }
        });
        
        // ============== Ø­Ù„ÙˆÙ„ Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„ØªÙ†Ø²ÙŠÙ„ ==============
        
        // Ø¯Ø§Ù„Ø© ØªÙ†Ø²ÙŠÙ„ Ù…Ø­Ø³Ù†Ø© ØªØ¹Ù…Ù„ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª
        function enhancedDownload(dataURL, filename) {
            try {
                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ÙˆØªÙ†Ø²ÙŠÙ„Ù‡
                const link = document.createElement('a');
                link.download = filename;
                link.href = dataURL;
                link.style.display = 'none';
                document.body.appendChild(link);
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ù‚Ø± Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹
                const clickEvent = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ø¯Ø«
                link.dispatchEvent(clickEvent);
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                try {
                    link.click();
                } catch (clickError) {
                    console.log('Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙØ´Ù„ØŒ Ø¬Ø±Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø£Ø®Ø±Ù‰:', clickError);
                }
                
                // ØªÙ†Ø¸ÙŠÙ
                setTimeout(() => {
                    if (link.parentNode) {
                        document.body.removeChild(link);
                    }
                    
                    // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù„Ø±ÙˆØ§Ø¨Ø· blob
                    if (link.href && link.href.startsWith('blob:')) {
                        URL.revokeObjectURL(link.href);
                    }
                }, 1000);
                
                return true;
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰:', error);
                
                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ÙØªØ­ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
                try {
                    const newWindow = window.open();
                    if (newWindow) {
                        newWindow.document.write('<img src="' + dataURL + '" />');
                        setTimeout(() => {
                            newWindow.document.close();
                            newWindow.print();
                        }, 500);
                    }
                } catch (windowError) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©:', windowError);
                    
                    // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    alert('Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©:\n1. Ø§Ø¶ØºØ· Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©\n2. Ø§Ø®ØªØ± "Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©" Ø£Ùˆ "ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©"');
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    const imgWindow = window.open('', '_blank');
                    imgWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <title>Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</title>
                            <style>
                                body { 
                                    margin: 0; 
                                    padding: 20px; 
                                    text-align: center; 
                                    font-family: Arial, sans-serif; 
                                    background: #f5f5f7;
                                }
                                .container { 
                                    max-width: 800px; 
                                    margin: 0 auto; 
                                    background: white; 
                                    padding: 20px; 
                                    border-radius: 10px; 
                                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                                }
                                img { 
                                    max-width: 100%; 
                                    height: auto; 
                                    border: 1px solid #ddd; 
                                    border-radius: 5px; 
                                    margin: 20px 0;
                                }
                                .instructions {
                                    background: #f8f9fa;
                                    padding: 15px;
                                    border-radius: 5px;
                                    margin: 20px 0;
                                    text-align: right;
                                }
                                .instructions h3 {
                                    margin-top: 0;
                                }
                                .instructions ol {
                                    text-align: right;
                                    padding-right: 20px;
                                }
                            </style>
                        </head>
                        <body>
                            <div class="container">
                                <h2>Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</h2>
                                <div class="instructions">
                                    <h3>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­ÙØ¸:</h3>
                                    <ol>
                                        <li>Ø§Ø¶ØºØ· Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©</li>
                                        <li>Ø§Ø®ØªØ± "Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©" Ø£Ùˆ "ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©"</li>
                                        <li>Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</li>
                                    </ol>
                                </div>
                                <img src="${dataURL}" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©" />
                                <p>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù: ${filename}</p>
                                <button onclick="window.print()" style="
                                    background: #007aff;
                                    color: white;
                                    border: none;
                                    padding: 10px 20px;
                                    border-radius: 5px;
                                    font-size: 16px;
                                    cursor: pointer;
                                    margin: 10px;
                                ">Ø·Ø¨Ø§Ø¹Ø©</button>
                                <button onclick="window.close()" style="
                                    background: #f44336;
                                    color: white;
                                    border: none;
                                    padding: 10px 20px;
                                    border-radius: 5px;
                                    font-size: 16px;
                                    cursor: pointer;
                                    margin: 10px;
                                ">Ø¥ØºÙ„Ø§Ù‚</button>
                            </div>
                        </body>
                        </html>
                    `);
                    imgWindow.document.close();
                }
                
                return false;
            }
        }
        
        // ============== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ==============
        
        // Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù…
        let downloadHelpShown = localStorage.getItem('downloadHelpShown');
        if (!downloadHelpShown) {
            setTimeout(() => {
                if (document.getElementById('editorPage').classList.contains('active')) {
                    const helpDiv = document.createElement('div');
                    helpDiv.id = 'firstTimeHelp';
                    helpDiv.style.cssText = `
                        position: fixed;
                        top: 100px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: #007aff;
                        color: white;
                        padding: 15px 20px;
                        border-radius: 10px;
                        z-index: 100000;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                        max-width: 90%;
                        text-align: center;
                        animation: fadeIn 0.5s ease-out;
                    `;
                    helpDiv.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 8px;">ğŸ’¡ ØªÙ„Ù…ÙŠØ­ Ø³Ø±ÙŠØ¹</div>
                        <div>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªÙ†Ø²ÙŠÙ„ <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">download</span> Ù„Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ø§Ù„Ù†Øµ</div>
                        <button onclick="this.parentElement.remove(); localStorage.setItem('downloadHelpShown', 'true');" 
                            style="
                                background: white;
                                color: #007aff;
                                border: none;
                                padding: 5px 15px;
                                border-radius: 5px;
                                margin-top: 10px;
                                font-weight: bold;
                                cursor: pointer;
                            ">Ø­Ø³Ù†Ø§Ù‹</button>
                    `;
                    document.body.appendChild(helpDiv);
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ
                    setTimeout(() => {
                        const help = document.getElementById('firstTimeHelp');
                        if (help && help.parentElement) {
                            help.remove();
                            localStorage.setItem('downloadHelpShown', 'true');
                        }
                    }, 10000);
                }
            }, 3000);
        }
        
        // ============== ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© ==============
        
        // ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ
        const textOverlay = document.getElementById('textOverlay');
        if (textOverlay) {
            textOverlay.addEventListener('touchstart', function(e) {
                // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ù†Øµ
                e.stopPropagation();
            }, { passive: true });
            
            textOverlay.addEventListener('input', function() {
                // Ø­ÙØ¸ Ø§Ù„Ù†Øµ Ù…Ø¤Ù‚ØªØ§Ù‹
                localStorage.setItem('textDraft', this.innerText);
            });
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­ÙÙˆØ¸
            const savedText = localStorage.getItem('textDraft');
            if (savedText && textOverlay.innerText === 'Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...') {
                textOverlay.innerText = savedText;
            }
        }
        
        // ============== Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙƒØ±Ø± ==============
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† canvas Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
        function resetCanvasContext() {
            const canvas = document.getElementById('canvas');
            if (canvas && canvas.getContext) {
                const ctx = canvas.getContext('2d');
                // Ù…Ø³Ø­ Ø£ÙŠ Ø±Ø³ÙˆÙ…Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }
        
        // ØªØ´ØºÙŠÙ„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù‚Ø¨Ù„ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© Ø±Ø³Ù…
        if (window.renderTextOnCanvas) {
            const originalRenderText = window.renderTextOnCanvas;
            window.renderTextOnCanvas = function() {
                resetCanvasContext();
                return originalRenderText.apply(this, arguments);
            };
        }
        
        // ============== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ© ==============
        
        // Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…ÙŠØ´Ù† Ù„Ù„ÙÙŠØ¯ÙŠÙˆ
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
                to { opacity: 1; transform: translateX(-50%) translateY(0); }
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            .pulse {
                animation: pulse 2s infinite;
            }
            
            @keyframes pulse {
                0% { opacity: 1; }
                50% { opacity: 0.7; }
                100% { opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        console.log('All enhancements loaded successfully!');
    </script>
</body>
</html>
